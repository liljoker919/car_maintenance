{% extends "base.html" %}
{% block content %}
<h2>Your Vehicles</h2>

<!-- ✅ Display success messages -->
{% if messages %}
<div class="alert alert-success">
    {% for message in messages %}
    {{ message }}
    {% endfor %}
</div>
{% endif %}

<!-- ✅ Add Vehicle Button -->
<button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
    + Add Vehicle
</button>

<!-- ✅ Add Vehicle Modal -->
<div class="modal fade" id="addVehicleModal" tabindex="-1" aria-labelledby="addVehicleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <form method="POST" action="{% url 'vehicle_add' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="addVehicleModalLabel">Add New Vehicle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    {{ form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ✅ Vehicle List -->
<ul class="list-unstyled mt-4">
    {% for vehicle in vehicles %}
    <li class="mb-4 border-bottom pb-3">
        <strong>{{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}</strong>
        <div class="mt-2">
            <!-- Edit Button -->
            <button class="btn btn-sm btn-warning me-2" data-bs-toggle="modal"
                data-bs-target="#editVehicleModal{{ vehicle.id }}">
                Edit
            </button>

            <!-- Delete Button -->
            <button class="btn btn-sm btn-danger" data-bs-toggle="modal"
                data-bs-target="#deleteVehicleModal{{ vehicle.id }}">
                Delete
            </button>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="editVehicleModal{{ vehicle.id }}" tabindex="-1"
            aria-labelledby="editVehicleModalLabel{{ vehicle.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-md">
                <div class="modal-content">
                    <form method="post" action="{% url 'vehicle_edit' vehicle.id %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="editVehicleModalLabel{{ vehicle.id }}">Edit Vehicle</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            {% include "vehicles/includes/vehicle_form_fields.html" with form=vehicle.get_edit_form %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Delete Modal -->
        <div class="modal fade" id="deleteVehicleModal{{ vehicle.id }}" tabindex="-1"
            aria-labelledby="deleteVehicleModalLabel{{ vehicle.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content">
                    <form method="post" action="{% url 'vehicle_delete' vehicle.id %}">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteVehicleModalLabel{{ vehicle.id }}">Delete Vehicle</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete <strong>{{ vehicle.year }} {{ vehicle.make }} {{
                                    vehicle.model }}</strong>?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </li>
    {% empty %}
    <li>No vehicles found.</li>
    {% endfor %}
</ul>
{% endblock %}